<html>
<head>
    <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/parand.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans|Italianno' rel='stylesheet' type='text/css'>
    <title>Python Scripts For Dumping Oracle Data And Loading Onto Hadoop DFS</title>
</head>

<body>

<div class="container">
    <div class="row navigation">
        <div class="span3">
            Parand Tony Darugar
        </div>
        <div class="span8 offset1">
            <span class="nav right"><a href="">About me</a></span>
            <span class="nav right"><a href="http://twitter.com/parand/">@parand</a></span>
            <span class="nav right">s@parand.com</span>
            <!-- span class="nav right"><input type="text" class="input-medium search-query"></span -->
            
        </div>
    </div>

    <div class="row headerrow">
        <div class="span7 heading"><a href="">Python Scripts For Dumping Oracle Data And Loading Onto Hadoop DFS</a></div>
        <div class="span5 subheading text-right">A Cruel and Petty Dictator</div>
    </div>

    <!-- CONTENT -->
    <div class="row content">
        <div class="span12">
<p>There have been several requests for this, so I might as well post it here for general use. I put together a simple system for dumping data out of Oracle databases and loading onto Hadoop DFS. The slightly interesting part is the parallelism - <a href='/web/20101222041009/http://pyprocessing.berlios.de/'>Python&#8217;s Processing library</a> is used to dump partitions in parallel and copy and load them onto DFS in parallel. This helps when dumping large amounts of data from partitioned Oracle tables.</p>

<p>The database interaction is handled by <a href='/web/20101222041009/http://parand.com/say/misc/db.py'>db.py</a> . There are a couple of helper functions for finding table partitions, etc. DBDumper dumps the requested fields from the requested table:</p>

<pre><code>dumper = db.DBDumper(&#39;username/password@yourhost:9999/DB&#39;, &#39;table_name&#39;,
      (&#39;field1&#39;, &#39;field2&#39;, &#39;field3&#39;), &#39;owner&#39;, &#39;partition&#39;, &#39;output_dir&#39;, 10)
dumper.dump(cp)</code></pre>

<p>Where 10 is the level of concurrency, <em>owner</em> is the owner of the table, and <em>partition</em> is the name of the partitions you&#8217;re interested in (can be None).</p>

<p><a href='/web/20101222041009/http://parand.com/say/misc/dfs.py'>dfs.py</a> copies the dumped files over in parallel, again using PyProcessing. It&#8217;s simply a wrapper around &#8220;cat | ssh | hadoop dfs -put&#8221;.</p>

<p>DBDumper and dfs are tied together via a callback - when each partition is dumped, the callback is invoked, triggering the dfs copy.</p>

<p>Here&#8217;s a complete example of using these to dump and copy data:</p>

<pre><code>import db
import dfs

fs = dfs.RemoteDFS(&#39;address.of.remote.machine&#39;)

def cp(arg):
    print &quot;CALLBACK:&quot;, arg
    fs.cp(arg[0], &#39;/some/directory/&#39; + arg[1] + &#39;/&#39; + arg[2])

dumper = db.DBDumper(&#39;username/password@yourhost:9999/DB&#39;, &#39;table_name&#39;,
     (&#39;field1&#39;, &#39;field2&#39;, &#39;field3&#39;), &#39;owner&#39;, &#39;partition&#39;, &#39;output_dir&#39;, 10)
dumper.dump(cp)</code></pre>
        </div>
    </div>

    <!-- div class="row contents">
        <div class="span12">
            <img class="img-polaroid" src="http://farm5.staticflickr.com/4148/5066965098_f73170bbf6_b.jpg">
        </div>
    </div>


    <div class="row contents">
        <div class="span12">
<em>What about our student loans?</em> asked one of the students.
        </div>
    </div -->

    <div class="row contents">
        <div class="span12 signature">
            Parand Tony Darugar - 22 Oct 2008
        </div>
    </div>

    <div class="row titlerow">
        <div class="span9 title">More:</div>
    </div>
    <div class="row ">
        <div class="span9 title">&raquo; Martin the Silly Rainbow</div>
        <div class="span3 title-details text-right">January 1st, 2013</div>
    </div>
    <div class="row ">
        <div class="span9 title">&raquo; If I Fell In Love With You</div>
        <div class="span3 title-details text-right">November 16th, 2013</div>
    </div>

</div>

</body>

</html>
