<html>
<head>
    <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/parand.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans|Italianno' rel='stylesheet' type='text/css'>
    <title>Parsing and Normalizing Dates with Timezones in Python</title>
</head>

<body>

<div class="container">
    <div class="row navigation">
        <div class="span3">
            Parand Tony Darugar
        </div>
        <div class="span8 offset1">
            <span class="nav right"><a href="">About me</a></span>
            <span class="nav right"><a href="http://twitter.com/parand/">@parand</a></span>
            <span class="nav right">s@parand.com</span>
            <!-- span class="nav right"><input type="text" class="input-medium search-query"></span -->
            
        </div>
    </div>

    <div class="row headerrow">
        <div class="span7 heading"><a href="">Parsing and Normalizing Dates with Timezones in Python</a></div>
        <div class="span5 subheading text-right">A Cruel and Petty Dictator</div>
    </div>

    <!-- CONTENT -->
    <div class="row content">
        <div class="span12">
<p>This was a bit painful and not well documented, so documenting here for future reference.</p>

<p>Say you want to parse and normalize dates with timezones (eg. dates in email headers, I believe based on rfc822). Here&#8217;s what you do:</p>

<p>Install <a href='/web/20101222053903/http://pytz.sourceforge.net/'>pytz</a>.</p>

<pre><code>import email, time, datetime
import pytz
utctimestamp = email.Utils.mktime_tz(email.Utils.parsedate_tz( msg[&#39;Date&#39;] ))
utcdate= datetime.datetime.fromtimestamp( utctimestamp, pytz.utc )
pacificdate = utcdate.astimezone(pytz.timezone(&#39;US/Pacific&#39;))</code></pre>

<p>parsedate_tz produces a tuple that can be digested by mktime_tz, which in turn spits out a timestamp based on the UTC timezone. You can turn this into a datetime via fromtimestamp and set its timezone to UTC. Once you have the TZ aware datetime you can manipulate it to your heart&#8217;s content; the final line above converts it to a US/Pacific date.</p>

<p>Full example:</p>

<pre><code>&gt;&gt;&gt; import email, time, datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; date_eastern = &#39;Thu, 31 Jan 2008 17:56:13 -0500&#39;
&gt;&gt;&gt; utctimestamp = email.Utils.mktime_tz(email.Utils.parsedate_tz( date_eastern ))
&gt;&gt;&gt; utcdate= datetime.datetime.fromtimestamp( utctimestamp, pytz.utc )
&gt;&gt;&gt; utcdate
datetime.datetime(2008, 1, 31, 22, 56, 13, tzinfo=&lt;UTC&gt;)
utcdate.astimezone(pytz.timezone(&#39;US/Pacific&#39;))
datetime.datetime(2008, 1, 31, 14, 56, 13, tzinfo=&lt;DstTzInfo &#39;US/Pacific&#39; PST-1 day, 16:00:00 STD&gt;)</code></pre>
        </div>
    </div>

    <!-- div class="row contents">
        <div class="span12">
            <img class="img-polaroid" src="http://farm5.staticflickr.com/4148/5066965098_f73170bbf6_b.jpg">
        </div>
    </div>


    <div class="row contents">
        <div class="span12">
<em>What about our student loans?</em> asked one of the students.
        </div>
    </div -->

    <div class="row contents">
        <div class="span12 signature">
            Parand Tony Darugar - 11 Feb 2008
        </div>
    </div>

    <div class="row titlerow">
        <div class="span9 title">More:</div>
    </div>
    <div class="row ">
        <div class="span9 title">&raquo; Martin the Silly Rainbow</div>
        <div class="span3 title-details text-right">January 1st, 2013</div>
    </div>
    <div class="row ">
        <div class="span9 title">&raquo; If I Fell In Love With You</div>
        <div class="span3 title-details text-right">November 16th, 2013</div>
    </div>

</div>

</body>

</html>
