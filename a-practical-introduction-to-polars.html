<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Practical Introduction to Polars for Python Data Processing - Parand</title>
    <link rel="shortcut icon" type="image/png" href="/theme/images/favico.png"/>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans">
    <link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600" data-optimized-fonts="true">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
        body {
          font-family: "EB Garmond",warnock-pro,Palatino,"Palatino Linotype","Palatino LT STD","Book Antiqua",Georgia,serif;
        }
        h1 { 
          font-size: x-large !important;
          font-weight: bold !important;
        }
        h2 { 
          font-size: larger !important;
          font-weight: bold !important;
        }
        div.highlight code {
          border: 1px solid #AAA;
          background-color: #fff !important;
          font-size: medium !important;
        }
        table.dataframe {
          background-color: #fff !important;
          font-family: monospace !important;
        }
        table.dataframe th {
          text-align: left !important;
          padding-right: 5px;
        }
        section.article a {
          color: brown !important;
        }

        .article-summary h1 {
          margin-top: 10px !important;
        }
    </style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XGEBWVBEKP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XGEBWVBEKP');
</script>

<link rel="canonical" href="https://www.parand.com/a-practical-introduction-to-polars.html" />

</head>


<body>
  
<div id="root" class="container py-2 mx-auto text-lg bg-gray-100 rounded max-w-6xl">

    <header class="text-gray-100 body-font bg-gray-700">
        <div class="container mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center text-xl bg-[url('/theme/images/header-bg-1-1920.jpg')]">
          <a class="flex title-font font-medium items-center text-gray-100 mb-4 md:mb-0" href="/">
            <img width=180 src="/theme/images/logo-parand.png">
            <span class="ml-5 text-3xl">Standard Deviations</span>
          </a>
          <nav class="md:ml-auto flex flex-wrap items-center justify-center text-2xl">
            <a class="mr-5 hover:text-gray-400" href="/">Blog</a>
            <a class="mr-5 hover:text-gray-400" href="/pages/writings.html">Writings</a>
            <a class="mr-5 hover:text-gray-400" href="/pages/parand-tony-darugar.html">About</a>
          </nav>
        </div>
    </header>

    <section class="text-gray-600 body-font overflow-hidden">
        <div class="container px-5 py-10 mx-auto">
            <div class="-my-8 divide-y-2 divide-gray-100">

<div class="content-article">

  <div class="py-8 row">
    <a href="a-practical-introduction-to-polars.html" class="text-3xl font-medium text-gray-900 title-font mb-2">A Practical Introduction to Polars for Python Data Processing</a>
    <header class="header-article">
        <div class="text-sm">Sat 18 February 2023</div>
    </header>
  </div>

    <section class='article'>
        
        <!-- div class="entry-summary">
            <p><a href="https://www.pola.rs/">Polars</a> is a "lightning-fast DataFrame library for Rust and Python" - if you're familiar with <a href="https://pandas.pydata.org/">Pandas</a>, Polars is quite similar but significantly faster and with a cleaner API. This post is a brief tour of how to set up and use Polars, working through a pragmatic example of the things you â€¦</p>
        </div -->
    
        <div class="entry-content space-y-5">
            <p><a href="https://www.pola.rs/">Polars</a> is a "lightning-fast DataFrame library for Rust and Python" - if you're familiar with <a href="https://pandas.pydata.org/">Pandas</a>, Polars is quite similar but significantly faster and with a cleaner API. This post is a brief tour of how to set up and use Polars, working through a pragmatic example of the things you might do in a typical data exploration project.</p>
<h2>The Setup</h2>
<p>Install polars and jupyter:</p>
<div class="highlight"><pre><span></span><code>python3 -m venv venv
source venv/bin/activate
pip install polars notebook
</code></pre></div>

<p>This sets up a python virtual environment, then installs the Polars library as well as jupyter. The page you're looking at was created as a jupyter notebook.</p>
<h2>The Data</h2>
<p>I'm using the <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">New York Taxi Dataset</a> parquet files in this notebook. I downloaded the <em>October 2022 Yellow Taxi Trip Records (PARQUET)</em> file, feel free to grab that as well.</p>
<p>The data is in parquet format, which is quite a nice format for data processing, significantly better than CSV.</p>
<h2>Polars</h2>
<p>Let's import polars and read the file:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;yellow_tripdata_2022-10.parquet&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div>

<p>Let's see what it looks like</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (5, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:03:41
</td>
<td>
2022-10-01 00:18:39
</td>
<td>
1.0
</td>
<td>
1.7
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
249
</td>
<td>
107
</td>
<td>
1
</td>
<td>
9.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.65
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
15.95
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:14:30
</td>
<td>
2022-10-01 00:19:48
</td>
<td>
2.0
</td>
<td>
0.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
151
</td>
<td>
238
</td>
<td>
2
</td>
<td>
5.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:27:13
</td>
<td>
2022-10-01 00:37:41
</td>
<td>
1.0
</td>
<td>
1.74
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
9.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.06
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.36
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:32:53
</td>
<td>
2022-10-01 00:38:55
</td>
<td>
0.0
</td>
<td>
1.3
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
142
</td>
<td>
239
</td>
<td>
1
</td>
<td>
6.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.05
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.35
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:44:55
</td>
<td>
2022-10-01 00:50:21
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
6.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.8
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.1
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>What are the columns in this file?</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>[&#39;VendorID&#39;,
 &#39;tpep_pickup_datetime&#39;,
 &#39;tpep_dropoff_datetime&#39;,
 &#39;passenger_count&#39;,
 &#39;trip_distance&#39;,
 &#39;RatecodeID&#39;,
 &#39;store_and_fwd_flag&#39;,
 &#39;PULocationID&#39;,
 &#39;DOLocationID&#39;,
 &#39;payment_type&#39;,
 &#39;fare_amount&#39;,
 &#39;extra&#39;,
 &#39;mta_tax&#39;,
 &#39;tip_amount&#39;,
 &#39;tolls_amount&#39;,
 &#39;improvement_surcharge&#39;,
 &#39;total_amount&#39;,
 &#39;congestion_surcharge&#39;,
 &#39;airport_fee&#39;]
</code></pre></div>

<p>Pretty easy to guess what the columns mean. </p>
<p>Let's poke around a little bit - what's the average taxi fare in NYC?</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">22.247540895418666</span><span class="w"></span>
</code></pre></div>

<p>I wonder how many passengers there are in each ride?</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="p">[</span><span class="s2">&quot;passenger_count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">1.3846936672698376</span><span class="w"></span>
</code></pre></div>

<p>How about the average fare from the airport? I noticed the <code>airport_fee</code> column, let's look at average <code>total_amount</code> when the airport fee is greater than zero:</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;airport_fee&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">55.83249747837022</span><span class="w"></span>
</code></pre></div>

<p>How about the average non-airport ride cost?</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;airport_fee&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">18.957161390687517</span><span class="w"></span>
</code></pre></div>

<h2>Most expensive rides</h2>
<p>Let's see what the most expensive fares in this data set are. We'll sort the data by <code>total_amount</code> and look at the top 10.</p>
<div class="highlight"><pre><span></span><code><span class="n">most_expensive</span> <span class="o">=</span> <span class="n">data</span>\
    <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;DOLocationID&quot;</span><span class="p">])</span>

<span class="n">most_expensive</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 3)</small>
<thead>
<tr>
<th>
total_amount
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1301.85
</td>
<td>
39
</td>
<td>
265
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
226
</td>
<td>
226
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
260
</td>
<td>
260
</td>
</tr>
<tr>
<td>
870.6
</td>
<td>
265
</td>
<td>
265
</td>
</tr>
<tr>
<td>
800.3
</td>
<td>
140
</td>
<td>
229
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
</tr>
<tr>
<td>
639.8
</td>
<td>
68
</td>
<td>
193
</td>
</tr>
<tr>
<td>
636.55
</td>
<td>
138
</td>
<td>
138
</td>
</tr>
<tr>
<td>
606.36
</td>
<td>
4
</td>
<td>
64
</td>
</tr>
</tbody>
</table>
</div>

<p>I'm selecting just the 3 columns I'm interested in so it's easier to look at the data - the amount and pick up and drop off locations.</p>
<p>Note the coding style above: I split the query into separate lines so it's easier to read. I've become a stickler when it comes to query / code style - you'll thank yourself for keeping it clean when you come back months later and try to figure out what you were doing.</p>
<p>We can make it even cleaner if we use the paranthesis syntax:</p>
<div class="highlight"><pre><span></span><code><span class="n">most_expensive</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;DOLocationID&quot;</span><span class="p">])</span>
<span class="p">)</span>
</code></pre></div>

<p>I wasn't crazy about the above syntax at first, but once I started using it I really liked it. </p>
<p>Also notice the style of computation here - we're chaining the actions, one after another, javascript style: sort, then take 10 rows, then select the columns we want. This I also like.</p>
<p>Looking at the data, apparently somebody paid \$1,301.85 for a single ride. I wonder where they went to? Let's find out.</p>
<p><code>PULocationID</code> and <code>DOLocationID</code> are the pick up and drop off location IDs. They're just numbers right now, not too informative. Let's convert them to names.</p>
<h2>Zone Names</h2>
<p>We need a mapping from the Zone IDs to the Zone names. From the <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">NYC TLC Data page</a>, look for the <em>Taxi Zone Lookup Table (CSV)</em> link and download the CSV file.</p>
<div class="highlight"><pre><span></span><code><span class="n">zone_data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;taxi+_zone_lookup.csv&quot;</span><span class="p">)</span>
<span class="n">zone_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 4)</small>
<thead>
<tr>
<th>
LocationID
</th>
<th>
Borough
</th>
<th>
Zone
</th>
<th>
service_zone
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
<td>
str
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
&quot;EWR&quot;
</td>
<td>
&quot;Newark Airport...
</td>
<td>
&quot;EWR&quot;
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&quot;Queens&quot;
</td>
<td>
&quot;Jamaica Bay&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&quot;Bronx&quot;
</td>
<td>
&quot;Allerton/Pelha...
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
4
</td>
<td>
&quot;Manhattan&quot;
</td>
<td>
&quot;Alphabet City&quot;
</td>
<td>
&quot;Yellow Zone&quot;
</td>
</tr>
<tr>
<td>
5
</td>
<td>
&quot;Staten Island&quot;
</td>
<td>
&quot;Arden Heights&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
6
</td>
<td>
&quot;Staten Island&quot;
</td>
<td>
&quot;Arrochar/Fort ...
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
7
</td>
<td>
&quot;Queens&quot;
</td>
<td>
&quot;Astoria&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
8
</td>
<td>
&quot;Queens&quot;
</td>
<td>
&quot;Astoria Park&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
9
</td>
<td>
&quot;Queens&quot;
</td>
<td>
&quot;Auburndale&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
<tr>
<td>
10
</td>
<td>
&quot;Queens&quot;
</td>
<td>
&quot;Baisley Park&quot;
</td>
<td>
&quot;Boro Zone&quot;
</td>
</tr>
</tbody>
</table>
</div>

<p>Ok, that's helpful, but I'd rather have the <code>Zone</code> and <code>Borough</code> together in a single column so it has all the info I need.</p>
<div class="highlight"><pre><span></span><code><span class="n">zone_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">zone_data</span>
    <span class="o">.</span><span class="n">with_column</span><span class="p">(</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Borough&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Zone&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;LocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">zone_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 2)</small>
<thead>
<tr>
<th>
LocationID
</th>
<th>
Location
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
&quot;EWR: Newark Ai...
</td>
</tr>
<tr>
<td>
2
</td>
<td>
&quot;Queens: Jamaic...
</td>
</tr>
<tr>
<td>
3
</td>
<td>
&quot;Bronx: Allerto...
</td>
</tr>
<tr>
<td>
4
</td>
<td>
&quot;Manhattan: Alp...
</td>
</tr>
<tr>
<td>
5
</td>
<td>
&quot;Staten Island:...
</td>
</tr>
<tr>
<td>
6
</td>
<td>
&quot;Staten Island:...
</td>
</tr>
<tr>
<td>
7
</td>
<td>
&quot;Queens: Astori...
</td>
</tr>
<tr>
<td>
8
</td>
<td>
&quot;Queens: Astori...
</td>
</tr>
<tr>
<td>
9
</td>
<td>
&quot;Queens: Auburn...
</td>
</tr>
<tr>
<td>
10
</td>
<td>
&quot;Queens: Baisle...
</td>
</tr>
</tbody>
</table>
</div>

<p>Ok, that's looking pretty good. Now let's look at those expensive rides again, but add in the pick up and drop off location names.</p>
<p>To do this I'll join the <code>most_expensive</code> dataframe I created above, which just had the fare and pick up and drop off IDs, with the <code>zone_data</code> dataframe which has the zone names. First I'll join the <code>PULocationID</code> with the zone data, add the location name, and rename the column from <code>Location</code> to <code>PickUpLocation</code>, then I'll do the same with the <code>DOLocationID</code>.</p>
<p>The left join below means use the rows from the left dataframe, which is the <code>most_expensive</code> dataframe, and injects into those rows the <code>Location</code> names from the <code>zone_data</code> dataframe, joining on <code>LocationID</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">most_expensive_rides</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">most_expensive</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;LocationID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Location&quot;</span><span class="p">:</span> <span class="s2">&quot;PickUpLocation&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;LocationID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Location&quot;</span><span class="p">:</span> <span class="s2">&quot;DropOffLocation&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="n">most_expensive_rides</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 5)</small>
<thead>
<tr>
<th>
total_amount
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
PickUpLocation
</th>
<th>
DropOffLocation
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
str
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1301.85
</td>
<td>
39
</td>
<td>
265
</td>
<td>
&quot;Brooklyn: Cana...
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
226
</td>
<td>
226
</td>
<td>
&quot;Queens: Sunnys...
</td>
<td>
&quot;Queens: Sunnys...
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
260
</td>
<td>
260
</td>
<td>
&quot;Queens: Woodsi...
</td>
<td>
&quot;Queens: Woodsi...
</td>
</tr>
<tr>
<td>
870.6
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
800.3
</td>
<td>
140
</td>
<td>
229
</td>
<td>
&quot;Manhattan: Len...
</td>
<td>
&quot;Manhattan: Sut...
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
639.8
</td>
<td>
68
</td>
<td>
193
</td>
<td>
&quot;Manhattan: Eas...
</td>
<td>
&quot;Queens: Queens...
</td>
</tr>
<tr>
<td>
636.55
</td>
<td>
138
</td>
<td>
138
</td>
<td>
&quot;Queens: LaGuar...
</td>
<td>
&quot;Queens: LaGuar...
</td>
</tr>
<tr>
<td>
606.36
</td>
<td>
4
</td>
<td>
64
</td>
<td>
&quot;Manhattan: Alp...
</td>
<td>
&quot;Queens: Dougla...
</td>
</tr>
</tbody>
</table>
</div>

<p>The location names are getting cut off when we view the dataframe - let's configure the output to show wider columns</p>
<div class="highlight"><pre><span></span><code><span class="n">pl</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span> <span class="n">set_fmt_str_lengths</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">most_expensive_rides</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 5)</small>
<thead>
<tr>
<th>
total_amount
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
PickUpLocation
</th>
<th>
DropOffLocation
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
str
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1301.85
</td>
<td>
39
</td>
<td>
265
</td>
<td>
&quot;Brooklyn: Canarsie&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
226
</td>
<td>
226
</td>
<td>
&quot;Queens: Sunnyside&quot;
</td>
<td>
&quot;Queens: Sunnyside&quot;
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
260
</td>
<td>
260
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
</tr>
<tr>
<td>
870.6
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
800.3
</td>
<td>
140
</td>
<td>
229
</td>
<td>
&quot;Manhattan: Lenox Hill East&quot;
</td>
<td>
&quot;Manhattan: Sutton Place/Turtle Bay North&quot;
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
750.3
</td>
<td>
265
</td>
<td>
265
</td>
<td>
&quot;Unknown: NA&quot;
</td>
<td>
&quot;Unknown: NA&quot;
</td>
</tr>
<tr>
<td>
639.8
</td>
<td>
68
</td>
<td>
193
</td>
<td>
&quot;Manhattan: East Chelsea&quot;
</td>
<td>
&quot;Queens: Queensbridge/Ravenswood&quot;
</td>
</tr>
<tr>
<td>
636.55
</td>
<td>
138
</td>
<td>
138
</td>
<td>
&quot;Queens: LaGuardia Airport&quot;
</td>
<td>
&quot;Queens: LaGuardia Airport&quot;
</td>
</tr>
<tr>
<td>
606.36
</td>
<td>
4
</td>
<td>
64
</td>
<td>
&quot;Manhattan: Alphabet City&quot;
</td>
<td>
&quot;Queens: Douglaston&quot;
</td>
</tr>
</tbody>
</table>
</div>

<p>The <code>Unknown: NA</code> locations are not very useful, let's get rid of them. I'll filter the data so they're excluded.</p>
<p>Location ID of 256 means <code>Unknown: NA</code>, so we need to get rid of any row that has 256 in the <code>PULocationID</code> or <code>DOLocationID</code> columns.</p>
<div class="highlight"><pre><span></span><code><span class="n">clean_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> 
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">clean_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (5, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:03:41
</td>
<td>
2022-10-01 00:18:39
</td>
<td>
1.0
</td>
<td>
1.7
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
249
</td>
<td>
107
</td>
<td>
1
</td>
<td>
9.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.65
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
15.95
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:14:30
</td>
<td>
2022-10-01 00:19:48
</td>
<td>
2.0
</td>
<td>
0.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
151
</td>
<td>
238
</td>
<td>
2
</td>
<td>
5.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:27:13
</td>
<td>
2022-10-01 00:37:41
</td>
<td>
1.0
</td>
<td>
1.74
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
9.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.06
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.36
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:32:53
</td>
<td>
2022-10-01 00:38:55
</td>
<td>
0.0
</td>
<td>
1.3
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
142
</td>
<td>
239
</td>
<td>
1
</td>
<td>
6.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.05
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.35
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:44:55
</td>
<td>
2022-10-01 00:50:21
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
6.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.8
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.1
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>Ok, now we can look at the most expensive rides again, with the Unknown locations removed</p>
<div class="highlight"><pre><span></span><code><span class="n">most_expensive</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">clean_data</span>
    <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;total_amount&quot;</span><span class="p">,</span> <span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;DOLocationID&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">most_expensive</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 3)</small>
<thead>
<tr>
<th>
total_amount
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
950.3
</td>
<td>
226
</td>
<td>
226
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
260
</td>
<td>
260
</td>
</tr>
<tr>
<td>
800.3
</td>
<td>
140
</td>
<td>
229
</td>
</tr>
<tr>
<td>
639.8
</td>
<td>
68
</td>
<td>
193
</td>
</tr>
<tr>
<td>
636.55
</td>
<td>
138
</td>
<td>
138
</td>
</tr>
<tr>
<td>
606.36
</td>
<td>
4
</td>
<td>
64
</td>
</tr>
<tr>
<td>
590.05
</td>
<td>
238
</td>
<td>
1
</td>
</tr>
<tr>
<td>
550.3
</td>
<td>
100
</td>
<td>
48
</td>
</tr>
<tr>
<td>
505.3
</td>
<td>
76
</td>
<td>
76
</td>
</tr>
<tr>
<td>
502.8
</td>
<td>
79
</td>
<td>
132
</td>
</tr>
</tbody>
</table>
</div>

<p>Let's add the location names back in. I'll create a function to do this so we can use it whenever we need.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_location_names</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">data</span>
        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;LocationID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Location&quot;</span><span class="p">:</span> <span class="s2">&quot;PickUpLocation&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;LocationID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Location&quot;</span><span class="p">:</span> <span class="s2">&quot;DropOffLocation&quot;</span><span class="p">})</span>
    <span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">add_location_names</span><span class="p">(</span><span class="n">most_expensive</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (10, 5)</small>
<thead>
<tr>
<th>
total_amount
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
PickUpLocation
</th>
<th>
DropOffLocation
</th>
</tr>
<tr>
<td>
f64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
str
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
950.3
</td>
<td>
226
</td>
<td>
226
</td>
<td>
&quot;Queens: Sunnyside&quot;
</td>
<td>
&quot;Queens: Sunnyside&quot;
</td>
</tr>
<tr>
<td>
950.3
</td>
<td>
260
</td>
<td>
260
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
</tr>
<tr>
<td>
800.3
</td>
<td>
140
</td>
<td>
229
</td>
<td>
&quot;Manhattan: Lenox Hill East&quot;
</td>
<td>
&quot;Manhattan: Sutton Place/Turtle Bay North&quot;
</td>
</tr>
<tr>
<td>
639.8
</td>
<td>
68
</td>
<td>
193
</td>
<td>
&quot;Manhattan: East Chelsea&quot;
</td>
<td>
&quot;Queens: Queensbridge/Ravenswood&quot;
</td>
</tr>
<tr>
<td>
636.55
</td>
<td>
138
</td>
<td>
138
</td>
<td>
&quot;Queens: LaGuardia Airport&quot;
</td>
<td>
&quot;Queens: LaGuardia Airport&quot;
</td>
</tr>
<tr>
<td>
606.36
</td>
<td>
4
</td>
<td>
64
</td>
<td>
&quot;Manhattan: Alphabet City&quot;
</td>
<td>
&quot;Queens: Douglaston&quot;
</td>
</tr>
<tr>
<td>
590.05
</td>
<td>
238
</td>
<td>
1
</td>
<td>
&quot;Manhattan: Upper West Side North&quot;
</td>
<td>
&quot;EWR: Newark Airport&quot;
</td>
</tr>
<tr>
<td>
550.3
</td>
<td>
100
</td>
<td>
48
</td>
<td>
&quot;Manhattan: Garment District&quot;
</td>
<td>
&quot;Manhattan: Clinton East&quot;
</td>
</tr>
<tr>
<td>
505.3
</td>
<td>
76
</td>
<td>
76
</td>
<td>
&quot;Brooklyn: East New York&quot;
</td>
<td>
&quot;Brooklyn: East New York&quot;
</td>
</tr>
<tr>
<td>
502.8
</td>
<td>
79
</td>
<td>
132
</td>
<td>
&quot;Manhattan: East Village&quot;
</td>
<td>
&quot;Queens: JFK Airport&quot;
</td>
</tr>
</tbody>
</table>
</div>

<p>Hmm. Somebody paid \$950.3 to go from Queens: Sunnyside to Queens: Sunnyside. Same for Woodside. There was also an \$800 ride from Lenox Hill East to Sutton Place, which according to Google is a 4 minute car ride.</p>
<p>I'm starting to think our data might have junk in it. Exciting - finding junk in you data means you're doing Data Science&trade;. Now we just have to throw in some Excel and we'll have Machine Learning&trade;.</p>
<p>There's a lot we could do from here. For example, we could calculate the average fare by pick up and drop off location. Or we can look at the impact of pick up time on fares (there's a <code>tpep_pickup_datetime</code> column in the data).</p>
<p>For some reason I decided it'd be interesting to see which pickup-dropoff location pairs have the highest variation in fare. We can figure this out by grouping the data by <code>("PULocationID", "DOLocationID")</code>, then calculating the standard deviation for each grouping, and looking at the locations with the highest deviation.</p>
<div class="highlight"><pre><span></span><code><span class="n">amount_stddevs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">clean_data</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;DOLocationID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;total_amount_stddev&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;total_amount_stddev&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="p">)</span>

<span class="n">amount_stddevs</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (20, 3)</small>
<thead>
<tr>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
total_amount_stddev
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
16
</td>
<td>
175
</td>
<td>
219.899498
</td>
</tr>
<tr>
<td>
192
</td>
<td>
129
</td>
<td>
190.126871
</td>
</tr>
<tr>
<td>
260
</td>
<td>
223
</td>
<td>
155.620968
</td>
</tr>
<tr>
<td>
93
</td>
<td>
192
</td>
<td>
137.885822
</td>
</tr>
<tr>
<td>
98
</td>
<td>
98
</td>
<td>
137.461869
</td>
</tr>
<tr>
<td>
194
</td>
<td>
129
</td>
<td>
137.14336
</td>
</tr>
<tr>
<td>
55
</td>
<td>
132
</td>
<td>
130.249069
</td>
</tr>
<tr>
<td>
50
</td>
<td>
182
</td>
<td>
129.223764
</td>
</tr>
<tr>
<td>
260
</td>
<td>
129
</td>
<td>
122.231773
</td>
</tr>
<tr>
<td>
206
</td>
<td>
206
</td>
<td>
120.172797
</td>
</tr>
<tr>
<td>
68
</td>
<td>
193
</td>
<td>
119.954706
</td>
</tr>
<tr>
<td>
250
</td>
<td>
250
</td>
<td>
119.445285
</td>
</tr>
<tr>
<td>
19
</td>
<td>
19
</td>
<td>
118.451447
</td>
</tr>
<tr>
<td>
85
</td>
<td>
28
</td>
<td>
115.611959
</td>
</tr>
<tr>
<td>
137
</td>
<td>
201
</td>
<td>
114.268456
</td>
</tr>
<tr>
<td>
223
</td>
<td>
174
</td>
<td>
111.510739
</td>
</tr>
<tr>
<td>
92
</td>
<td>
252
</td>
<td>
110.662211
</td>
</tr>
<tr>
<td>
132
</td>
<td>
184
</td>
<td>
107.047076
</td>
</tr>
<tr>
<td>
164
</td>
<td>
187
</td>
<td>
104.368961
</td>
</tr>
<tr>
<td>
209
</td>
<td>
117
</td>
<td>
103.060813
</td>
</tr>
</tbody>
</table>
</div>

<p>Let's add the location names:</p>
<div class="highlight"><pre><span></span><code><span class="n">add_location_names</span><span class="p">(</span><span class="n">amount_stddevs</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (20, 5)</small>
<thead>
<tr>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
total_amount_stddev
</th>
<th>
PickUpLocation
</th>
<th>
DropOffLocation
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
str
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
16
</td>
<td>
175
</td>
<td>
219.899498
</td>
<td>
&quot;Queens: Bayside&quot;
</td>
<td>
&quot;Queens: Oakland Gardens&quot;
</td>
</tr>
<tr>
<td>
192
</td>
<td>
129
</td>
<td>
190.126871
</td>
<td>
&quot;Queens: Queensboro Hill&quot;
</td>
<td>
&quot;Queens: Jackson Heights&quot;
</td>
</tr>
<tr>
<td>
260
</td>
<td>
223
</td>
<td>
155.620968
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
<td>
&quot;Queens: Steinway&quot;
</td>
</tr>
<tr>
<td>
93
</td>
<td>
192
</td>
<td>
137.885822
</td>
<td>
&quot;Queens: Flushing Meadows-Corona Park&quot;
</td>
<td>
&quot;Queens: Queensboro Hill&quot;
</td>
</tr>
<tr>
<td>
98
</td>
<td>
98
</td>
<td>
137.461869
</td>
<td>
&quot;Queens: Fresh Meadows&quot;
</td>
<td>
&quot;Queens: Fresh Meadows&quot;
</td>
</tr>
<tr>
<td>
194
</td>
<td>
129
</td>
<td>
137.14336
</td>
<td>
&quot;Manhattan: Randalls Island&quot;
</td>
<td>
&quot;Queens: Jackson Heights&quot;
</td>
</tr>
<tr>
<td>
55
</td>
<td>
132
</td>
<td>
130.249069
</td>
<td>
&quot;Brooklyn: Coney Island&quot;
</td>
<td>
&quot;Queens: JFK Airport&quot;
</td>
</tr>
<tr>
<td>
50
</td>
<td>
182
</td>
<td>
129.223764
</td>
<td>
&quot;Manhattan: Clinton West&quot;
</td>
<td>
&quot;Bronx: Parkchester&quot;
</td>
</tr>
<tr>
<td>
260
</td>
<td>
129
</td>
<td>
122.231773
</td>
<td>
&quot;Queens: Woodside&quot;
</td>
<td>
&quot;Queens: Jackson Heights&quot;
</td>
</tr>
<tr>
<td>
206
</td>
<td>
206
</td>
<td>
120.172797
</td>
<td>
&quot;Staten Island: Saint George/New Brighton&quot;
</td>
<td>
&quot;Staten Island: Saint George/New Brighton&quot;
</td>
</tr>
<tr>
<td>
68
</td>
<td>
193
</td>
<td>
119.954706
</td>
<td>
&quot;Manhattan: East Chelsea&quot;
</td>
<td>
&quot;Queens: Queensbridge/Ravenswood&quot;
</td>
</tr>
<tr>
<td>
250
</td>
<td>
250
</td>
<td>
119.445285
</td>
<td>
&quot;Bronx: Westchester Village/Unionport&quot;
</td>
<td>
&quot;Bronx: Westchester Village/Unionport&quot;
</td>
</tr>
<tr>
<td>
19
</td>
<td>
19
</td>
<td>
118.451447
</td>
<td>
&quot;Queens: Bellerose&quot;
</td>
<td>
&quot;Queens: Bellerose&quot;
</td>
</tr>
<tr>
<td>
85
</td>
<td>
28
</td>
<td>
115.611959
</td>
<td>
&quot;Brooklyn: Erasmus&quot;
</td>
<td>
&quot;Queens: Briarwood/Jamaica Hills&quot;
</td>
</tr>
<tr>
<td>
137
</td>
<td>
201
</td>
<td>
114.268456
</td>
<td>
&quot;Manhattan: Kips Bay&quot;
</td>
<td>
&quot;Queens: Rockaway Park&quot;
</td>
</tr>
<tr>
<td>
223
</td>
<td>
174
</td>
<td>
111.510739
</td>
<td>
&quot;Queens: Steinway&quot;
</td>
<td>
&quot;Bronx: Norwood&quot;
</td>
</tr>
<tr>
<td>
92
</td>
<td>
252
</td>
<td>
110.662211
</td>
<td>
&quot;Queens: Flushing&quot;
</td>
<td>
&quot;Queens: Whitestone&quot;
</td>
</tr>
<tr>
<td>
132
</td>
<td>
184
</td>
<td>
107.047076
</td>
<td>
&quot;Queens: JFK Airport&quot;
</td>
<td>
&quot;Bronx: Pelham Bay Park&quot;
</td>
</tr>
<tr>
<td>
164
</td>
<td>
187
</td>
<td>
104.368961
</td>
<td>
&quot;Manhattan: Midtown South&quot;
</td>
<td>
&quot;Staten Island: Port Richmond&quot;
</td>
</tr>
<tr>
<td>
209
</td>
<td>
117
</td>
<td>
103.060813
</td>
<td>
&quot;Manhattan: Seaport&quot;
</td>
<td>
&quot;Queens: Hammels/Arverne&quot;
</td>
</tr>
</tbody>
</table>
</div>

<p>That's... less interesting than I thought it would be. I suppose the absolute values are pretty interesting - our top hit, Queens: Bayside to Queens: Oakland Gardens, is about a 5 minute car ride and has a standard deviatiion of \$220. That seems suspect.</p>
<p>This much standard deviation means we have bad data. </p>
<h2>Data Exploration and Cleansing</h2>
<p>A lot of real-world data work involves cleaning data and finding outliers, so let's try that with this data.</p>
<p>There are a number of techniques for finding outliers, but first let's take a better look at our data. Polars has a built-in <code>describe</code> function that calculates basic statistics for your dataframe:</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (7, 20)</small>
<thead>
<tr>
<th>
describe
</th>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&quot;count&quot;
</td>
<td>
3.675411e6
</td>
<td>
&quot;3675411&quot;
</td>
<td>
&quot;3675411&quot;
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
&quot;3675411&quot;
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
<td>
3.675411e6
</td>
</tr>
<tr>
<td>
&quot;null_count&quot;
</td>
<td>
0.0
</td>
<td>
&quot;0&quot;
</td>
<td>
&quot;0&quot;
</td>
<td>
133021.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
&quot;133021&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
133021.0
</td>
</tr>
<tr>
<td>
&quot;mean&quot;
</td>
<td>
1.720443
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.384694
</td>
<td>
6.206977
</td>
<td>
1.424337
</td>
<td>
null
</td>
<td>
165.498365
</td>
<td>
162.891786
</td>
<td>
1.188275
</td>
<td>
15.299953
</td>
<td>
0.987793
</td>
<td>
0.487229
</td>
<td>
2.859254
</td>
<td>
0.583306
</td>
<td>
0.295531
</td>
<td>
22.247541
</td>
<td>
2.28062
</td>
<td>
0.103128
</td>
</tr>
<tr>
<td>
&quot;std&quot;
</td>
<td>
0.480032
</td>
<td>
null
</td>
<td>
null
</td>
<td>
0.930231
</td>
<td>
640.823768
</td>
<td>
5.685591
</td>
<td>
null
</td>
<td>
65.213026
</td>
<td>
70.197474
</td>
<td>
0.540651
</td>
<td>
14.674444
</td>
<td>
1.242828
</td>
<td>
0.101155
</td>
<td>
3.374175
</td>
<td>
2.111967
</td>
<td>
0.051038
</td>
<td>
18.368245
</td>
<td>
0.75784
</td>
<td>
0.347974
</td>
</tr>
<tr>
<td>
&quot;min&quot;
</td>
<td>
1.0
</td>
<td>
&quot;2008-12-31 23:02:01.000000000&quot;
</td>
<td>
&quot;2009-01-01 02:20:59.000000000&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
-1294.5
</td>
<td>
-22.18
</td>
<td>
-0.5
</td>
<td>
-100.01
</td>
<td>
-70.0
</td>
<td>
-0.3
</td>
<td>
-1301.85
</td>
<td>
-2.5
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
&quot;max&quot;
</td>
<td>
6.0
</td>
<td>
&quot;2022-11-01 01:27:35.000000000&quot;
</td>
<td>
&quot;2022-11-03 17:26:46.000000000&quot;
</td>
<td>
9.0
</td>
<td>
389678.46
</td>
<td>
99.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
265.0
</td>
<td>
265.0
</td>
<td>
4.0
</td>
<td>
1294.5
</td>
<td>
10.8
</td>
<td>
25.48
</td>
<td>
500.0
</td>
<td>
516.75
</td>
<td>
1.0
</td>
<td>
1301.85
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
&quot;median&quot;
</td>
<td>
2.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.0
</td>
<td>
1.9
</td>
<td>
1.0
</td>
<td>
null
</td>
<td>
162.0
</td>
<td>
162.0
</td>
<td>
1.0
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.22
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.55
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>That's pretty helpful - for example, the minimum pick up date is <code>2008-12-31</code>, which means this data starts all the way back to 2009. Because of the way the TLC data download page is organized I thought I only had data from October 2023.</p>
<p>The largest tip amount is \$500 (<code>max</code> of the <code>tip_amount</code> column). The minimum tip is \$-100.01. Must've been a pretty rough ride.</p>
<p>Looking at the <code>total_amount</code> column we see that the maximum ride amount was \$1301.85 and the minimum was -\$1301.85. I don't know much about this data, but I'm going to guess that's an incorrectly charged ride and a refund. That's unfortunate - having large invalid data (\$1301.85 and -\$1301.85) at either extreme of values will wreak havoc on our standard deviations and such.</p>
<p>The longest ride (<code>max</code> of the <code>trip_distance</code> field) is 389678.46. Is that in miles? Let's look at the <a href="https://www.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf">data dictionary</a> provided by the TLC. </p>
<p><img alt="Screenshot%202023-01-16%20at%207.15.01%20AM.png" src="/static/images/nyctaxi-info.png"></p>
<p>It is in fact in miles. The length of the United States is about 3000 miles, so this enterprising taxi travelled the entire US about 130 times.</p>
<p>The data dictionary tells us a lot of other useful things - for example, the <code>Payment_type</code> column should help us find disputed, voided, and other invalid charges.</p>
<h2>Basic Cleaning</h2>
<p>So what should we do? I'm thinking we look at more recent data, say anything 2020 and after. Let's get rid of anything with more than 3000 miles, and let's also get rid of rows with unreasonable negative numbers - eg. negative total amounts, tolls, etc. We can get rid of rows where the <code>Payment_type</code> is No Charge, Dispute, Voided, etc.</p>
<p>The trouble is if we just get rid of the negative amounts and disputes then we're leaving the corresponding equally invalid positive amount in the data - eg. if we drop the row that has the -\$1301.85 amount we'll still have the \$1301.85 row in our data.</p>
<p>We'll have to figure out how to drop both: for each of the negative numbers, we'll need to find the corresponding positive amount and get rid of those rows too.</p>
<p>Let's take a look at the outlier data and see if spot any clues for how to get rid of them.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">)</span> <span class="o">|</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;total_amount&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1300</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (2, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2
</td>
<td>
2022-10-12 07:00:43
</td>
<td>
2022-10-12 12:31:57
</td>
<td>
4.0
</td>
<td>
259.33
</td>
<td>
4.0
</td>
<td>
&quot;N&quot;
</td>
<td>
39
</td>
<td>
265
</td>
<td>
2
</td>
<td>
-1294.5
</td>
<td>
0.0
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
-6.55
</td>
<td>
-0.3
</td>
<td>
-1301.85
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-12 07:00:43
</td>
<td>
2022-10-12 12:31:57
</td>
<td>
4.0
</td>
<td>
259.33
</td>
<td>
4.0
</td>
<td>
&quot;N&quot;
</td>
<td>
39
</td>
<td>
265
</td>
<td>
2
</td>
<td>
1294.5
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
1301.85
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>The payment type is 2, which is cash. Somebody paid $1300 in cash, then got it handed back to him. I was hoping the payment type would be Voided or something reasonable.</p>
<p>Getting rid of these invalid pairs is going to be a bit painful - we'll have to find each invalid ride and also find its pair.</p>
<p>Before we do that, let's see if the problems still exists in data we care about, which is data from 2020 onwards.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="s2">&quot;2020&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Comparing</span><span class="w"> </span><span class="n">date</span><span class="sr">/datetime/</span><span class="n">time</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">value</span><span class="o">,</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">lead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">comparison</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">unlikely</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="o">.</span><span class="w"></span>
<span class="n">If</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">intended</span><span class="o">,</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">cast</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">silence</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">warning</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (7, 20)</small>
<thead>
<tr>
<th>
describe
</th>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&quot;count&quot;
</td>
<td>
3.675407e6
</td>
<td>
&quot;3675407&quot;
</td>
<td>
&quot;3675407&quot;
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
&quot;3675407&quot;
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
</tr>
<tr>
<td>
&quot;null_count&quot;
</td>
<td>
0.0
</td>
<td>
&quot;0&quot;
</td>
<td>
&quot;0&quot;
</td>
<td>
133021.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
&quot;133021&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
133021.0
</td>
</tr>
<tr>
<td>
&quot;mean&quot;
</td>
<td>
1.720442
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.384694
</td>
<td>
6.206973
</td>
<td>
1.424337
</td>
<td>
null
</td>
<td>
165.498365
</td>
<td>
162.891771
</td>
<td>
1.188275
</td>
<td>
15.299922
</td>
<td>
0.987794
</td>
<td>
0.487229
</td>
<td>
2.859248
</td>
<td>
0.583304
</td>
<td>
0.295531
</td>
<td>
22.247504
</td>
<td>
2.280621
</td>
<td>
0.103127
</td>
</tr>
<tr>
<td>
&quot;std&quot;
</td>
<td>
0.480032
</td>
<td>
null
</td>
<td>
null
</td>
<td>
0.930231
</td>
<td>
640.824117
</td>
<td>
5.685594
</td>
<td>
null
</td>
<td>
65.213049
</td>
<td>
70.197445
</td>
<td>
0.540651
</td>
<td>
14.674414
</td>
<td>
1.242828
</td>
<td>
0.101155
</td>
<td>
3.374169
</td>
<td>
2.111966
</td>
<td>
0.051038
</td>
<td>
18.368208
</td>
<td>
0.757839
</td>
<td>
0.347973
</td>
</tr>
<tr>
<td>
&quot;min&quot;
</td>
<td>
1.0
</td>
<td>
&quot;2022-09-30 14:06:36.000000000&quot;
</td>
<td>
&quot;2022-09-30 14:23:04.000000000&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
-1294.5
</td>
<td>
-22.18
</td>
<td>
-0.5
</td>
<td>
-100.01
</td>
<td>
-70.0
</td>
<td>
-0.3
</td>
<td>
-1301.85
</td>
<td>
-2.5
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
&quot;max&quot;
</td>
<td>
6.0
</td>
<td>
&quot;2022-11-01 01:27:35.000000000&quot;
</td>
<td>
&quot;2022-11-03 17:26:46.000000000&quot;
</td>
<td>
9.0
</td>
<td>
389678.46
</td>
<td>
99.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
265.0
</td>
<td>
265.0
</td>
<td>
4.0
</td>
<td>
1294.5
</td>
<td>
10.8
</td>
<td>
25.48
</td>
<td>
500.0
</td>
<td>
516.75
</td>
<td>
1.0
</td>
<td>
1301.85
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
&quot;median&quot;
</td>
<td>
2.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.0
</td>
<td>
1.9
</td>
<td>
1.0
</td>
<td>
null
</td>
<td>
162.0
</td>
<td>
162.0
</td>
<td>
1.0
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.22
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.55
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>That didn't work - our <code>min tpep_pickup_datetime</code> is <code>2022-09-30</code> (I was expecting 2020). I guess I can't filter a <code>datetime</code> column (<code>tpep_pickup_datetime</code>) using a string ("2020"). Makes sense, let's fix it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtering data to start at </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">start_date</span> <span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>Filtering data to start at 2020-01-01 00:00:00
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (7, 20)</small>
<thead>
<tr>
<th>
describe
</th>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&quot;count&quot;
</td>
<td>
3.675407e6
</td>
<td>
&quot;3675407&quot;
</td>
<td>
&quot;3675407&quot;
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
&quot;3675407&quot;
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
<td>
3.675407e6
</td>
</tr>
<tr>
<td>
&quot;null_count&quot;
</td>
<td>
0.0
</td>
<td>
&quot;0&quot;
</td>
<td>
&quot;0&quot;
</td>
<td>
133021.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
&quot;133021&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
133021.0
</td>
<td>
133021.0
</td>
</tr>
<tr>
<td>
&quot;mean&quot;
</td>
<td>
1.720442
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.384694
</td>
<td>
6.206973
</td>
<td>
1.424337
</td>
<td>
null
</td>
<td>
165.498365
</td>
<td>
162.891771
</td>
<td>
1.188275
</td>
<td>
15.299922
</td>
<td>
0.987794
</td>
<td>
0.487229
</td>
<td>
2.859248
</td>
<td>
0.583304
</td>
<td>
0.295531
</td>
<td>
22.247504
</td>
<td>
2.280621
</td>
<td>
0.103127
</td>
</tr>
<tr>
<td>
&quot;std&quot;
</td>
<td>
0.480032
</td>
<td>
null
</td>
<td>
null
</td>
<td>
0.930231
</td>
<td>
640.824117
</td>
<td>
5.685594
</td>
<td>
null
</td>
<td>
65.213049
</td>
<td>
70.197445
</td>
<td>
0.540651
</td>
<td>
14.674414
</td>
<td>
1.242828
</td>
<td>
0.101155
</td>
<td>
3.374169
</td>
<td>
2.111966
</td>
<td>
0.051038
</td>
<td>
18.368208
</td>
<td>
0.757839
</td>
<td>
0.347973
</td>
</tr>
<tr>
<td>
&quot;min&quot;
</td>
<td>
1.0
</td>
<td>
&quot;2022-09-30 14:06:36.000000000&quot;
</td>
<td>
&quot;2022-09-30 14:23:04.000000000&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
-1294.5
</td>
<td>
-22.18
</td>
<td>
-0.5
</td>
<td>
-100.01
</td>
<td>
-70.0
</td>
<td>
-0.3
</td>
<td>
-1301.85
</td>
<td>
-2.5
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
&quot;max&quot;
</td>
<td>
6.0
</td>
<td>
&quot;2022-11-01 01:27:35.000000000&quot;
</td>
<td>
&quot;2022-11-03 17:26:46.000000000&quot;
</td>
<td>
9.0
</td>
<td>
389678.46
</td>
<td>
99.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
265.0
</td>
<td>
265.0
</td>
<td>
4.0
</td>
<td>
1294.5
</td>
<td>
10.8
</td>
<td>
25.48
</td>
<td>
500.0
</td>
<td>
516.75
</td>
<td>
1.0
</td>
<td>
1301.85
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
&quot;median&quot;
</td>
<td>
2.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.0
</td>
<td>
1.9
</td>
<td>
1.0
</td>
<td>
null
</td>
<td>
162.0
</td>
<td>
162.0
</td>
<td>
1.0
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.22
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.55
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>My <code>min tpep_pickup_datetime</code> is still <code>2022-09-30</code> (I was expecting 2020). What's going on? Maybe our data is only for Octover 2022 after all, and the 2008 date I was seeing was spurious? Note that we had 3675411 data points before we filtered by date and now we have 3675407 data points (I'm getting this by looking at the <code>count</code> field for <code>tpep_pickup_datetime</code>). Our date filtering only got rid of 4 data points. So we're looking only at October 2022 data with a couple of spurious data points thrown in.</p>
<p>I'm curious what the data with bad dates look like.</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">start_date</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (4, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2
</td>
<td>
2009-01-01 01:57:50
</td>
<td>
2009-01-01 02:20:59
</td>
<td>
1.0
</td>
<td>
7.84
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
161
</td>
<td>
264
</td>
<td>
2
</td>
<td>
22.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
23.3
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2008-12-31 23:02:01
</td>
<td>
2009-01-01 19:08:45
</td>
<td>
1.0
</td>
<td>
22.93
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
132
</td>
<td>
25
</td>
<td>
1
</td>
<td>
63.0
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
13.01
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
78.06
</td>
<td>
0.0
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2008-12-31 23:02:02
</td>
<td>
2009-01-01 20:14:39
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
2.0
</td>
<td>
&quot;N&quot;
</td>
<td>
231
</td>
<td>
231
</td>
<td>
1
</td>
<td>
52.0
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
10.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
66.55
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2009-01-01 00:02:31
</td>
<td>
2009-01-01 17:02:49
</td>
<td>
1.0
</td>
<td>
8.11
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
186
</td>
<td>
1
</td>
<td>
35.5
</td>
<td>
1.0
</td>
<td>
0.5
</td>
<td>
9.52
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
57.12
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
</tbody>
</table>
</div>

<h2>Finding bad pairs</h2>
<p>I don't see any obvious ways to correlate the bad pairs - the rows don't have IDs, there is no cab ID, and the payment method field doesn't give us much either. We'll have to data science.</p>
<p>Let's try this:
- Find negative data points
- For each negative data point, find a data point with the same amount but positive that also matches other parameters such as date and pick up / drop off location</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (25899, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:52:07
</td>
<td>
2022-10-01 01:02:44
</td>
<td>
1.0
</td>
<td>
2.83
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
141
</td>
<td>
79
</td>
<td>
4
</td>
<td>
-10.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-14.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:29:57
</td>
<td>
2022-10-01 00:34:37
</td>
<td>
1.0
</td>
<td>
0.31
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
264
</td>
<td>
264
</td>
<td>
4
</td>
<td>
-4.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-8.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:31:37
</td>
<td>
2022-10-01 00:32:53
</td>
<td>
1.0
</td>
<td>
0.31
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
138
</td>
<td>
4
</td>
<td>
-3.0
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-5.55
</td>
<td>
0.0
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:46:38
</td>
<td>
2022-10-01 00:46:44
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
2.0
</td>
<td>
&quot;N&quot;
</td>
<td>
249
</td>
<td>
249
</td>
<td>
3
</td>
<td>
-52.0
</td>
<td>
0.0
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-55.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:06:08
</td>
<td>
2022-10-01 00:48:23
</td>
<td>
1.0
</td>
<td>
17.05
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
175
</td>
<td>
4
</td>
<td>
-50.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
-6.55
</td>
<td>
-0.3
</td>
<td>
-60.85
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:40:58
</td>
<td>
2022-10-01 00:56:33
</td>
<td>
1.0
</td>
<td>
2.7
</td>
<td>
5.0
</td>
<td>
&quot;N&quot;
</td>
<td>
148
</td>
<td>
90
</td>
<td>
4
</td>
<td>
-27.31
</td>
<td>
0.0
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-30.61
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:43:19
</td>
<td>
2022-10-01 00:44:02
</td>
<td>
1.0
</td>
<td>
0.02
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
90
</td>
<td>
90
</td>
<td>
3
</td>
<td>
-2.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-6.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:12:32
</td>
<td>
2022-10-01 00:12:51
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
48
</td>
<td>
48
</td>
<td>
4
</td>
<td>
-2.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-6.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:12:24
</td>
<td>
2022-10-01 00:13:06
</td>
<td>
1.0
</td>
<td>
0.33
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
138
</td>
<td>
4
</td>
<td>
-3.0
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-5.55
</td>
<td>
0.0
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:39:21
</td>
<td>
2022-10-01 00:40:07
</td>
<td>
4.0
</td>
<td>
0.15
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
230
</td>
<td>
230
</td>
<td>
3
</td>
<td>
-2.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-6.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:08:25
</td>
<td>
2022-10-01 00:21:22
</td>
<td>
2.0
</td>
<td>
1.46
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
79
</td>
<td>
211
</td>
<td>
4
</td>
<td>
-9.5
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-13.3
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:45:01
</td>
<td>
2022-10-01 01:18:01
</td>
<td>
2.0
</td>
<td>
2.35
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
79
</td>
<td>
249
</td>
<td>
4
</td>
<td>
-13.0
</td>
<td>
-0.5
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-16.8
</td>
<td>
-2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-06 16:17:49
</td>
<td>
2022-10-06 16:20:42
</td>
<td>
null
</td>
<td>
0.28
</td>
<td>
null
</td>
<td>
null
</td>
<td>
79
</td>
<td>
107
</td>
<td>
0
</td>
<td>
-95.68
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
15.22
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-77.16
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-10 12:27:10
</td>
<td>
2022-10-10 12:56:00
</td>
<td>
null
</td>
<td>
60043.58
</td>
<td>
null
</td>
<td>
null
</td>
<td>
125
</td>
<td>
68
</td>
<td>
0
</td>
<td>
-17.28
</td>
<td>
0.0
</td>
<td>
-0.5
</td>
<td>
-4.49
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-24.77
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-13 21:55:30
</td>
<td>
2022-10-13 21:56:26
</td>
<td>
null
</td>
<td>
0.03
</td>
<td>
null
</td>
<td>
null
</td>
<td>
144
</td>
<td>
144
</td>
<td>
0
</td>
<td>
-27.33
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
3.69
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-20.34
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-13 22:44:00
</td>
<td>
2022-10-13 22:45:00
</td>
<td>
null
</td>
<td>
0.03
</td>
<td>
null
</td>
<td>
null
</td>
<td>
90
</td>
<td>
90
</td>
<td>
0
</td>
<td>
-38.85
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
6.62
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-28.93
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-14 03:26:00
</td>
<td>
2022-10-14 03:27:00
</td>
<td>
null
</td>
<td>
0.04
</td>
<td>
null
</td>
<td>
null
</td>
<td>
114
</td>
<td>
114
</td>
<td>
0
</td>
<td>
-26.79
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-23.49
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-16 04:52:00
</td>
<td>
2022-10-16 05:01:00
</td>
<td>
null
</td>
<td>
2.71
</td>
<td>
null
</td>
<td>
null
</td>
<td>
233
</td>
<td>
262
</td>
<td>
0
</td>
<td>
-61.61
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
5.9
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-52.41
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-18 13:06:39
</td>
<td>
2022-10-18 13:06:52
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
232
</td>
<td>
232
</td>
<td>
0
</td>
<td>
-0.8
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
2.5
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-19 01:55:00
</td>
<td>
2022-10-19 01:56:00
</td>
<td>
null
</td>
<td>
0.06
</td>
<td>
null
</td>
<td>
null
</td>
<td>
237
</td>
<td>
237
</td>
<td>
0
</td>
<td>
-22.39
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.92
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-16.17
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-22 19:35:59
</td>
<td>
2022-10-22 19:36:03
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
239
</td>
<td>
239
</td>
<td>
0
</td>
<td>
-0.8
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
2.5
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-25 07:40:00
</td>
<td>
2022-10-25 07:42:00
</td>
<td>
null
</td>
<td>
0.07
</td>
<td>
null
</td>
<td>
null
</td>
<td>
140
</td>
<td>
140
</td>
<td>
0
</td>
<td>
-54.25
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
7.29
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-43.66
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-28 09:13:07
</td>
<td>
2022-10-28 09:13:26
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
141
</td>
<td>
141
</td>
<td>
0
</td>
<td>
-0.8
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
2.5
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-29 07:33:24
</td>
<td>
2022-10-29 07:37:01
</td>
<td>
null
</td>
<td>
0.5
</td>
<td>
null
</td>
<td>
null
</td>
<td>
37
</td>
<td>
37
</td>
<td>
0
</td>
<td>
-18.55
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.72
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
-15.03
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>There's probably a clever way to do this, but my initial thought for getting rid of the corresponding positives is to create a new dataframe with the negative rows, then do an anti-join back to the original dataframe. An anti-join should find matching rows and remove them.</p>
<div class="highlight"><pre><span></span><code><span class="n">negative_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;fare_amount&quot;</span><span class="p">])</span>

<span class="n">negative_data</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (25899, 3)</small>
<thead>
<tr>
<th>
tpep_pickup_datetime
</th>
<th>
PULocationID
</th>
<th>
fare_amount
</th>
</tr>
<tr>
<td>
datetime[ns]
</td>
<td>
i64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2022-10-01 00:52:07
</td>
<td>
141
</td>
<td>
-10.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:29:57
</td>
<td>
264
</td>
<td>
-4.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:31:37
</td>
<td>
138
</td>
<td>
-3.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:46:38
</td>
<td>
249
</td>
<td>
-52.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:06:08
</td>
<td>
238
</td>
<td>
-50.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:40:58
</td>
<td>
148
</td>
<td>
-27.31
</td>
</tr>
<tr>
<td>
2022-10-01 00:43:19
</td>
<td>
90
</td>
<td>
-2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:12:32
</td>
<td>
48
</td>
<td>
-2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:12:24
</td>
<td>
138
</td>
<td>
-3.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:39:21
</td>
<td>
230
</td>
<td>
-2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:08:25
</td>
<td>
79
</td>
<td>
-9.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:45:01
</td>
<td>
79
</td>
<td>
-13.0
</td>
</tr>
<tr>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<td>
2022-10-06 16:17:49
</td>
<td>
79
</td>
<td>
-95.68
</td>
</tr>
<tr>
<td>
2022-10-10 12:27:10
</td>
<td>
125
</td>
<td>
-17.28
</td>
</tr>
<tr>
<td>
2022-10-13 21:55:30
</td>
<td>
144
</td>
<td>
-27.33
</td>
</tr>
<tr>
<td>
2022-10-13 22:44:00
</td>
<td>
90
</td>
<td>
-38.85
</td>
</tr>
<tr>
<td>
2022-10-14 03:26:00
</td>
<td>
114
</td>
<td>
-26.79
</td>
</tr>
<tr>
<td>
2022-10-16 04:52:00
</td>
<td>
233
</td>
<td>
-61.61
</td>
</tr>
<tr>
<td>
2022-10-18 13:06:39
</td>
<td>
232
</td>
<td>
-0.8
</td>
</tr>
<tr>
<td>
2022-10-19 01:55:00
</td>
<td>
237
</td>
<td>
-22.39
</td>
</tr>
<tr>
<td>
2022-10-22 19:35:59
</td>
<td>
239
</td>
<td>
-0.8
</td>
</tr>
<tr>
<td>
2022-10-25 07:40:00
</td>
<td>
140
</td>
<td>
-54.25
</td>
</tr>
<tr>
<td>
2022-10-28 09:13:07
</td>
<td>
141
</td>
<td>
-0.8
</td>
</tr>
<tr>
<td>
2022-10-29 07:33:24
</td>
<td>
37
</td>
<td>
-18.55
</td>
</tr>
</tbody>
</table>
</div>

<p>I'm only grabbing a few columns for my negative_data dataframe, since all I'm going to use it for is to remove the corresponding positive rows from the original data. I'll try matching on the pick up date and pick up location.</p>
<p>Let's convert the negative amounts to positive so we can directly match them to their corresponding positive rows in the original data.</p>
<div class="highlight"><pre><span></span><code><span class="n">negative_data</span> <span class="o">=</span> <span class="n">negative_data</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
    <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;amount_positive&quot;</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">negative_data</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (25899, 4)</small>
<thead>
<tr>
<th>
tpep_pickup_datetime
</th>
<th>
PULocationID
</th>
<th>
fare_amount
</th>
<th>
amount_positive
</th>
</tr>
<tr>
<td>
datetime[ns]
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
2022-10-01 00:52:07
</td>
<td>
141
</td>
<td>
-10.5
</td>
<td>
10.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:29:57
</td>
<td>
264
</td>
<td>
-4.5
</td>
<td>
4.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:31:37
</td>
<td>
138
</td>
<td>
-3.0
</td>
<td>
3.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:46:38
</td>
<td>
249
</td>
<td>
-52.0
</td>
<td>
52.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:06:08
</td>
<td>
238
</td>
<td>
-50.5
</td>
<td>
50.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:40:58
</td>
<td>
148
</td>
<td>
-27.31
</td>
<td>
27.31
</td>
</tr>
<tr>
<td>
2022-10-01 00:43:19
</td>
<td>
90
</td>
<td>
-2.5
</td>
<td>
2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:12:32
</td>
<td>
48
</td>
<td>
-2.5
</td>
<td>
2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:12:24
</td>
<td>
138
</td>
<td>
-3.0
</td>
<td>
3.0
</td>
</tr>
<tr>
<td>
2022-10-01 00:39:21
</td>
<td>
230
</td>
<td>
-2.5
</td>
<td>
2.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:08:25
</td>
<td>
79
</td>
<td>
-9.5
</td>
<td>
9.5
</td>
</tr>
<tr>
<td>
2022-10-01 00:45:01
</td>
<td>
79
</td>
<td>
-13.0
</td>
<td>
13.0
</td>
</tr>
<tr>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<td>
2022-10-06 16:17:49
</td>
<td>
79
</td>
<td>
-95.68
</td>
<td>
95.68
</td>
</tr>
<tr>
<td>
2022-10-10 12:27:10
</td>
<td>
125
</td>
<td>
-17.28
</td>
<td>
17.28
</td>
</tr>
<tr>
<td>
2022-10-13 21:55:30
</td>
<td>
144
</td>
<td>
-27.33
</td>
<td>
27.33
</td>
</tr>
<tr>
<td>
2022-10-13 22:44:00
</td>
<td>
90
</td>
<td>
-38.85
</td>
<td>
38.85
</td>
</tr>
<tr>
<td>
2022-10-14 03:26:00
</td>
<td>
114
</td>
<td>
-26.79
</td>
<td>
26.79
</td>
</tr>
<tr>
<td>
2022-10-16 04:52:00
</td>
<td>
233
</td>
<td>
-61.61
</td>
<td>
61.61
</td>
</tr>
<tr>
<td>
2022-10-18 13:06:39
</td>
<td>
232
</td>
<td>
-0.8
</td>
<td>
0.8
</td>
</tr>
<tr>
<td>
2022-10-19 01:55:00
</td>
<td>
237
</td>
<td>
-22.39
</td>
<td>
22.39
</td>
</tr>
<tr>
<td>
2022-10-22 19:35:59
</td>
<td>
239
</td>
<td>
-0.8
</td>
<td>
0.8
</td>
</tr>
<tr>
<td>
2022-10-25 07:40:00
</td>
<td>
140
</td>
<td>
-54.25
</td>
<td>
54.25
</td>
</tr>
<tr>
<td>
2022-10-28 09:13:07
</td>
<td>
141
</td>
<td>
-0.8
</td>
<td>
0.8
</td>
</tr>
<tr>
<td>
2022-10-29 07:33:24
</td>
<td>
37
</td>
<td>
-18.55
</td>
<td>
18.55
</td>
</tr>
</tbody>
</table>
</div>

<p>Now that we have a dataframe with the negative amounts converted to positive, we can join back to the original data, matching on the (now positive) fare amount and the pick up location. We'll do an anti-join, which gets rids of the rows that match. If Polars didn't have anti-join as an option we could have merged the new dataframe with the original data and dropped duplicate rows.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negative_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;fare_amount&quot;</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;anti&quot;</span><span class="p">)</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (3649512, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:03:41
</td>
<td>
2022-10-01 00:18:39
</td>
<td>
1.0
</td>
<td>
1.7
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
249
</td>
<td>
107
</td>
<td>
1
</td>
<td>
9.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.65
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
15.95
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:14:30
</td>
<td>
2022-10-01 00:19:48
</td>
<td>
2.0
</td>
<td>
0.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
151
</td>
<td>
238
</td>
<td>
2
</td>
<td>
5.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:27:13
</td>
<td>
2022-10-01 00:37:41
</td>
<td>
1.0
</td>
<td>
1.74
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
9.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.06
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.36
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:32:53
</td>
<td>
2022-10-01 00:38:55
</td>
<td>
0.0
</td>
<td>
1.3
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
142
</td>
<td>
239
</td>
<td>
1
</td>
<td>
6.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.05
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.35
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:44:55
</td>
<td>
2022-10-01 00:50:21
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
6.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.8
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.1
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:22:52
</td>
<td>
2022-10-01 00:52:14
</td>
<td>
1.0
</td>
<td>
6.8
</td>
<td>
1.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
186
</td>
<td>
41
</td>
<td>
2
</td>
<td>
25.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
29.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:33:19
</td>
<td>
2022-10-01 00:44:51
</td>
<td>
3.0
</td>
<td>
1.88
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
162
</td>
<td>
145
</td>
<td>
2
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
14.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:02:42
</td>
<td>
2022-10-01 00:50:01
</td>
<td>
1.0
</td>
<td>
12.2
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
100
</td>
<td>
22
</td>
<td>
1
</td>
<td>
41.0
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
3.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
47.8
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:06:35
</td>
<td>
2022-10-01 00:24:38
</td>
<td>
1.0
</td>
<td>
7.79
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
112
</td>
<td>
1
</td>
<td>
23.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
4.96
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
31.01
</td>
<td>
0.0
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:29:25
</td>
<td>
2022-10-01 00:43:15
</td>
<td>
1.0
</td>
<td>
4.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
145
</td>
<td>
75
</td>
<td>
1
</td>
<td>
14.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.5
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.8
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:01:55
</td>
<td>
2022-10-01 00:20:16
</td>
<td>
1.0
</td>
<td>
8.8
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
236
</td>
<td>
1
</td>
<td>
26.0
</td>
<td>
4.25
</td>
<td>
0.5
</td>
<td>
5.64
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
43.24
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:27:48
</td>
<td>
2022-10-01 00:59:50
</td>
<td>
1.0
</td>
<td>
8.6
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
140
</td>
<td>
36
</td>
<td>
1
</td>
<td>
29.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
6.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
39.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:30:42
</td>
<td>
2022-10-31 23:40:16
</td>
<td>
null
</td>
<td>
1.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
158
</td>
<td>
90
</td>
<td>
0
</td>
<td>
9.95
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.93
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.18
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:42:05
</td>
<td>
2022-11-01 00:13:58
</td>
<td>
null
</td>
<td>
17.5
</td>
<td>
null
</td>
<td>
null
</td>
<td>
132
</td>
<td>
68
</td>
<td>
0
</td>
<td>
52.0
</td>
<td>
1.25
</td>
<td>
0.5
</td>
<td>
9.46
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
72.56
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:52:34
</td>
<td>
2022-11-01 00:23:32
</td>
<td>
null
</td>
<td>
12.6
</td>
<td>
null
</td>
<td>
null
</td>
<td>
116
</td>
<td>
37
</td>
<td>
0
</td>
<td>
40.67
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
5.26
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
53.28
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:16:12
</td>
<td>
2022-10-31 23:32:36
</td>
<td>
null
</td>
<td>
6.23
</td>
<td>
null
</td>
<td>
null
</td>
<td>
158
</td>
<td>
166
</td>
<td>
0
</td>
<td>
22.5
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
5.67
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
31.47
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:15:00
</td>
<td>
2022-10-31 23:20:00
</td>
<td>
null
</td>
<td>
0.72
</td>
<td>
null
</td>
<td>
null
</td>
<td>
142
</td>
<td>
142
</td>
<td>
0
</td>
<td>
9.95
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.92
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.17
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:20:21
</td>
<td>
2022-10-31 23:34:15
</td>
<td>
null
</td>
<td>
2.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
163
</td>
<td>
68
</td>
<td>
0
</td>
<td>
12.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
3.95
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.75
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:45:37
</td>
<td>
2022-11-01 00:00:39
</td>
<td>
null
</td>
<td>
2.45
</td>
<td>
null
</td>
<td>
null
</td>
<td>
249
</td>
<td>
162
</td>
<td>
0
</td>
<td>
11.97
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
3.39
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
18.66
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:56:35
</td>
<td>
2022-11-01 00:10:11
</td>
<td>
null
</td>
<td>
2.25
</td>
<td>
null
</td>
<td>
null
</td>
<td>
137
</td>
<td>
50
</td>
<td>
0
</td>
<td>
12.68
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
3.16
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.14
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:22:00
</td>
<td>
2022-10-31 23:28:00
</td>
<td>
null
</td>
<td>
1.22
</td>
<td>
null
</td>
<td>
null
</td>
<td>
142
</td>
<td>
161
</td>
<td>
0
</td>
<td>
10.0
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
14.3
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:25:00
</td>
<td>
2022-10-31 23:48:00
</td>
<td>
null
</td>
<td>
4.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
186
</td>
<td>
45
</td>
<td>
0
</td>
<td>
19.07
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
4.97
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
27.34
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:32:54
</td>
<td>
2022-10-31 23:33:02
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
264
</td>
<td>
263
</td>
<td>
0
</td>
<td>
16.82
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
4.58
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
22.2
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:21:34
</td>
<td>
2022-10-31 23:32:42
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
166
</td>
<td>
116
</td>
<td>
0
</td>
<td>
8.93
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.73
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>Did that work? Let's see how many rows that got rid of.
After the anti-join we end up with 3649512 rows. We had and 25899 rows with negative values.</p>
<div class="highlight"><pre><span></span><code><span class="n">n_rows_original</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_rows_negative</span> <span class="o">=</span> <span class="n">negative_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We are expecting </span><span class="si">{</span><span class="n">n_rows_original</span> <span class="o">-</span> <span class="n">n_rows_negative</span><span class="si">}</span><span class="s2"> rows if our removal worked perfectly&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nv">We</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">expecting</span><span class="w"> </span><span class="mi">3649512</span><span class="w"> </span><span class="nv">rows</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">our</span><span class="w"> </span><span class="nv">removal</span><span class="w"> </span><span class="nv">worked</span><span class="w"> </span><span class="nv">perfectly</span><span class="w"></span>
</code></pre></div>

<p>Sure enough the result of the anti-join has 3649512 rows (you can see that from the shape output a few cells above), so our method is working well. We should sanity check to make sure it's working as expected, but for now let's assume all is well.</p>
<p>We can now do our final cleaning: we'll get rid of the negative and corresponding positive rows, get rid of anything where the mileage is over 3000 miles, remove dates that are out of range, and get rid of rows with unknown pick up and drop off locations:</p>
<div class="highlight"><pre><span></span><code><span class="n">clean_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">negative_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">,</span> <span class="s2">&quot;fare_amount&quot;</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;anti&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;fare_amount&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;trip_distance&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3000</span> <span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;tpep_pickup_datetime&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">start_date</span> <span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span> 
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;PULocationID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;DOLocationID&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">265</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">clean_data</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (3630123, 19)</small>
<thead>
<tr>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
i64
</td>
<td>
datetime[ns]
</td>
<td>
datetime[ns]
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
i64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:03:41
</td>
<td>
2022-10-01 00:18:39
</td>
<td>
1.0
</td>
<td>
1.7
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
249
</td>
<td>
107
</td>
<td>
1
</td>
<td>
9.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.65
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
15.95
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:14:30
</td>
<td>
2022-10-01 00:19:48
</td>
<td>
2.0
</td>
<td>
0.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
151
</td>
<td>
238
</td>
<td>
2
</td>
<td>
5.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:27:13
</td>
<td>
2022-10-01 00:37:41
</td>
<td>
1.0
</td>
<td>
1.74
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
9.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.06
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.36
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:32:53
</td>
<td>
2022-10-01 00:38:55
</td>
<td>
0.0
</td>
<td>
1.3
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
142
</td>
<td>
239
</td>
<td>
1
</td>
<td>
6.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
2.05
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
12.35
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:44:55
</td>
<td>
2022-10-01 00:50:21
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
238
</td>
<td>
166
</td>
<td>
1
</td>
<td>
6.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.8
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.1
</td>
<td>
0.0
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:22:52
</td>
<td>
2022-10-01 00:52:14
</td>
<td>
1.0
</td>
<td>
6.8
</td>
<td>
1.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
186
</td>
<td>
41
</td>
<td>
2
</td>
<td>
25.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
29.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:33:19
</td>
<td>
2022-10-01 00:44:51
</td>
<td>
3.0
</td>
<td>
1.88
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
162
</td>
<td>
145
</td>
<td>
2
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
14.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:02:42
</td>
<td>
2022-10-01 00:50:01
</td>
<td>
1.0
</td>
<td>
12.2
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
100
</td>
<td>
22
</td>
<td>
1
</td>
<td>
41.0
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
3.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
47.8
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:06:35
</td>
<td>
2022-10-01 00:24:38
</td>
<td>
1.0
</td>
<td>
7.79
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
112
</td>
<td>
1
</td>
<td>
23.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
4.96
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
31.01
</td>
<td>
0.0
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-01 00:29:25
</td>
<td>
2022-10-01 00:43:15
</td>
<td>
1.0
</td>
<td>
4.72
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
145
</td>
<td>
75
</td>
<td>
1
</td>
<td>
14.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
1.5
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.8
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:01:55
</td>
<td>
2022-10-01 00:20:16
</td>
<td>
1.0
</td>
<td>
8.8
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
138
</td>
<td>
236
</td>
<td>
1
</td>
<td>
26.0
</td>
<td>
4.25
</td>
<td>
0.5
</td>
<td>
5.64
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
43.24
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-01 00:27:48
</td>
<td>
2022-10-01 00:59:50
</td>
<td>
1.0
</td>
<td>
8.6
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
140
</td>
<td>
36
</td>
<td>
1
</td>
<td>
29.5
</td>
<td>
3.0
</td>
<td>
0.5
</td>
<td>
6.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
39.3
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
<tr>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:30:42
</td>
<td>
2022-10-31 23:40:16
</td>
<td>
null
</td>
<td>
1.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
158
</td>
<td>
90
</td>
<td>
0
</td>
<td>
9.95
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.93
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.18
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:42:05
</td>
<td>
2022-11-01 00:13:58
</td>
<td>
null
</td>
<td>
17.5
</td>
<td>
null
</td>
<td>
null
</td>
<td>
132
</td>
<td>
68
</td>
<td>
0
</td>
<td>
52.0
</td>
<td>
1.25
</td>
<td>
0.5
</td>
<td>
9.46
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
72.56
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:52:34
</td>
<td>
2022-11-01 00:23:32
</td>
<td>
null
</td>
<td>
12.6
</td>
<td>
null
</td>
<td>
null
</td>
<td>
116
</td>
<td>
37
</td>
<td>
0
</td>
<td>
40.67
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
5.26
</td>
<td>
6.55
</td>
<td>
0.3
</td>
<td>
53.28
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:16:12
</td>
<td>
2022-10-31 23:32:36
</td>
<td>
null
</td>
<td>
6.23
</td>
<td>
null
</td>
<td>
null
</td>
<td>
158
</td>
<td>
166
</td>
<td>
0
</td>
<td>
22.5
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
5.67
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
31.47
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:15:00
</td>
<td>
2022-10-31 23:20:00
</td>
<td>
null
</td>
<td>
0.72
</td>
<td>
null
</td>
<td>
null
</td>
<td>
142
</td>
<td>
142
</td>
<td>
0
</td>
<td>
9.95
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
2.92
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.17
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:20:21
</td>
<td>
2022-10-31 23:34:15
</td>
<td>
null
</td>
<td>
2.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
163
</td>
<td>
68
</td>
<td>
0
</td>
<td>
12.0
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
3.95
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.75
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:45:37
</td>
<td>
2022-11-01 00:00:39
</td>
<td>
null
</td>
<td>
2.45
</td>
<td>
null
</td>
<td>
null
</td>
<td>
249
</td>
<td>
162
</td>
<td>
0
</td>
<td>
11.97
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
3.39
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
18.66
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:56:35
</td>
<td>
2022-11-01 00:10:11
</td>
<td>
null
</td>
<td>
2.25
</td>
<td>
null
</td>
<td>
null
</td>
<td>
137
</td>
<td>
50
</td>
<td>
0
</td>
<td>
12.68
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
3.16
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
19.14
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:22:00
</td>
<td>
2022-10-31 23:28:00
</td>
<td>
null
</td>
<td>
1.22
</td>
<td>
null
</td>
<td>
null
</td>
<td>
142
</td>
<td>
161
</td>
<td>
0
</td>
<td>
10.0
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
14.3
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:25:00
</td>
<td>
2022-10-31 23:48:00
</td>
<td>
null
</td>
<td>
4.7
</td>
<td>
null
</td>
<td>
null
</td>
<td>
186
</td>
<td>
45
</td>
<td>
0
</td>
<td>
19.07
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
4.97
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
27.34
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2022-10-31 23:32:54
</td>
<td>
2022-10-31 23:33:02
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
264
</td>
<td>
263
</td>
<td>
0
</td>
<td>
16.82
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
4.58
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
22.2
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
<tr>
<td>
1
</td>
<td>
2022-10-31 23:21:34
</td>
<td>
2022-10-31 23:32:42
</td>
<td>
null
</td>
<td>
0.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
166
</td>
<td>
116
</td>
<td>
0
</td>
<td>
8.93
</td>
<td>
0.0
</td>
<td>
0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
9.73
</td>
<td>
null
</td>
<td>
null
</td>
</tr>
</tbody>
</table>
</div>

<p>How many rows of data did we get rid of?</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">clean_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">45288</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">clean_data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }

    .dataframe td {
        white-space: pre;
    }

    .dataframe td {
        padding-top: 0;
    }

    .dataframe td {
        padding-bottom: 0;
    }

    .dataframe td {
        line-height: 95%;
    }
</style>
<table border="1" class="dataframe">
<small>shape: (7, 20)</small>
<thead>
<tr>
<th>
describe
</th>
<th>
VendorID
</th>
<th>
tpep_pickup_datetime
</th>
<th>
tpep_dropoff_datetime
</th>
<th>
passenger_count
</th>
<th>
trip_distance
</th>
<th>
RatecodeID
</th>
<th>
store_and_fwd_flag
</th>
<th>
PULocationID
</th>
<th>
DOLocationID
</th>
<th>
payment_type
</th>
<th>
fare_amount
</th>
<th>
extra
</th>
<th>
mta_tax
</th>
<th>
tip_amount
</th>
<th>
tolls_amount
</th>
<th>
improvement_surcharge
</th>
<th>
total_amount
</th>
<th>
congestion_surcharge
</th>
<th>
airport_fee
</th>
</tr>
<tr>
<td>
str
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
str
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
<td>
f64
</td>
</tr>
</thead>
<tbody>
<tr>
<td>
&quot;count&quot;
</td>
<td>
3.630123e6
</td>
<td>
&quot;3630123&quot;
</td>
<td>
&quot;3630123&quot;
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
&quot;3630123&quot;
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
<td>
3.630123e6
</td>
</tr>
<tr>
<td>
&quot;null_count&quot;
</td>
<td>
0.0
</td>
<td>
&quot;0&quot;
</td>
<td>
&quot;0&quot;
</td>
<td>
126893.0
</td>
<td>
0.0
</td>
<td>
126893.0
</td>
<td>
&quot;126893&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
126893.0
</td>
<td>
126893.0
</td>
</tr>
<tr>
<td>
&quot;mean&quot;
</td>
<td>
1.712003
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.384814
</td>
<td>
3.554337
</td>
<td>
1.413354
</td>
<td>
null
</td>
<td>
165.373444
</td>
<td>
162.575655
</td>
<td>
1.174523
</td>
<td>
15.200393
</td>
<td>
1.001434
</td>
<td>
0.494995
</td>
<td>
2.854254
</td>
<td>
0.571016
</td>
<td>
0.299767
</td>
<td>
22.190213
</td>
<td>
2.319343
</td>
<td>
0.103112
</td>
</tr>
<tr>
<td>
&quot;std&quot;
</td>
<td>
0.45283
</td>
<td>
null
</td>
<td>
null
</td>
<td>
0.931426
</td>
<td>
4.456602
</td>
<td>
5.684473
</td>
<td>
null
</td>
<td>
65.14861
</td>
<td>
70.034565
</td>
<td>
0.504213
</td>
<td>
13.14293
</td>
<td>
1.242161
</td>
<td>
0.0556
</td>
<td>
3.227445
</td>
<td>
2.036301
</td>
<td>
0.009334
</td>
<td>
16.768073
</td>
<td>
0.648033
</td>
<td>
0.343979
</td>
</tr>
<tr>
<td>
&quot;min&quot;
</td>
<td>
1.0
</td>
<td>
&quot;2022-09-30 14:06:36.000000000&quot;
</td>
<td>
&quot;2022-09-30 14:23:04.000000000&quot;
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
1.0
</td>
<td>
&quot;N&quot;
</td>
<td>
1.0
</td>
<td>
1.0
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-22.18
</td>
<td>
-0.5
</td>
<td>
0.0
</td>
<td>
0.0
</td>
<td>
-0.3
</td>
<td>
-4.55
</td>
<td>
-2.5
</td>
<td>
-1.25
</td>
</tr>
<tr>
<td>
&quot;max&quot;
</td>
<td>
2.0
</td>
<td>
&quot;2022-11-01 01:27:35.000000000&quot;
</td>
<td>
&quot;2022-11-03 17:26:46.000000000&quot;
</td>
<td>
9.0
</td>
<td>
462.86
</td>
<td>
99.0
</td>
<td>
&quot;Y&quot;
</td>
<td>
264.0
</td>
<td>
264.0
</td>
<td>
4.0
</td>
<td>
950.0
</td>
<td>
10.8
</td>
<td>
25.48
</td>
<td>
500.0
</td>
<td>
516.75
</td>
<td>
0.3
</td>
<td>
950.3
</td>
<td>
2.5
</td>
<td>
1.25
</td>
</tr>
<tr>
<td>
&quot;median&quot;
</td>
<td>
2.0
</td>
<td>
null
</td>
<td>
null
</td>
<td>
1.0
</td>
<td>
1.9
</td>
<td>
1.0
</td>
<td>
null
</td>
<td>
162.0
</td>
<td>
162.0
</td>
<td>
1.0
</td>
<td>
10.5
</td>
<td>
0.5
</td>
<td>
0.5
</td>
<td>
2.25
</td>
<td>
0.0
</td>
<td>
0.3
</td>
<td>
16.55
</td>
<td>
2.5
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
</div>

<p>That's looking better - we still have some negatives and other strange looking things, but you get a sense of how we'd approach getting rid of those. For next steps I'd probably filter more things that look incorrect, then I'd plot the data as a histogram and eyeball it to see if there's anything strange in there.</p>
<p>Let's stop there.</p>
<p>This was my first foray into Polars, so it's likely there are more polarsy ways of doing things - if you know of improvements please let me know.</p>
<p>Overall I really like Polars. It's fast and clean and the resulting code is easy on the eyes. I'm likely to use it in place of Pandas going forward.</p>
<h2>Links</h2>
<p><a href="https://kevinheavey.github.io/modern-polars/">Modern Polars</a> is quite nice with many examples.</p>
<p>Towards Data Science has a good article called <a href="https://towardsdatascience.com/pandas-dataframe-but-much-faster-f475d6be4cd4">Polars: Pandas DataFrame but Much Faster</a>.</p>
<p><a href="https://www.codemag.com/Article/2212051/Using-the-Polars-DataFrame-Library">This article from Code Magazine</a> has a lot of good Polars examples.</p>
<p>The Polars documentation page on <a href="https://pola-rs.github.io/polars-book/user-guide/coming_from_pandas.html">Coming from Pandas</a> is very useful if you have Pandas experience.</p>
<p>While we're at it, read <a href="https://kentnerburn.com/the-cab-ride-ill-never-forget/">this piece from a former cab driver on the ride he'll never forget</a>.</p>
        </div>
    </section>
    <footer class="footer-article py-8">
        <div class="tags-and-categories"><span class="italic">Category: </span><a href="https://www.parand.com/category/technical.html">Technical</a>
| <span class="italic">Tags:</span> <a class="inline-block py-1 px-2 rounded bg-indigo-50 text-indigo-500 text-base font-medium tracking-widest" href="https://www.parand.com/tag/technical.html">technical </a><a class="inline-block py-1 px-2 rounded bg-indigo-50 text-indigo-500 text-base font-medium tracking-widest" href="https://www.parand.com/tag/python.html">python </a>        </div>
    </footer>
    <!-- disqus  -->

  </div>
            </div>
            </div>
          </div>
        </div>
    </section>

</div>


</body>
</html>